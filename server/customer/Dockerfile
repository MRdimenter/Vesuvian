# Use a base image with Java
FROM eclipse-temurin:17-jre-alpine

# Expose the port the app runs in
EXPOSE 8090

# Add the following build arguments
ARG KEYCLOAK_POSTGRES_PASSWORD
ARG KEYCLOAK_ADMIN_PASSWORD
ARG KEYCLOAK_SUPERUSER_PASSWORD
ARG KEYCLOAK_USER_ADMIN_PASSWORD
ARG CUSTOMER_POSTGRES_PASSWORD
ARG JAR_FILE=target/customer-1.0.jar

# Add the jar file to the container
ADD ${JAR_FILE} app.jar

# Add environment variables
ENV KEYCLOAK_POSTGRES_PASSWORD=$KEYCLOAK_POSTGRES_PASSWORD
ENV KEYCLOAK_ADMIN_PASSWORD=$KEYCLOAK_ADMIN_PASSWORD
ENV KEYCLOAK_SUPERUSER_PASSWORD=$KEYCLOAK_SUPERUSER_PASSWORD
ENV KEYCLOAK_USER_ADMIN_PASSWORD=$KEYCLOAK_USER_ADMIN_PASSWORD
ENV CUSTOMER_POSTGRES_PASSWORD=$CUSTOMER_POSTGRES_PASSWORD
ENV RABBITMQ_USER_ADMIN_PASSWORD=$RABBITMQ_USER_ADMIN_PASSWORD

# Command to run the application
ENTRYPOINT ["java","-jar","/app.jar"]
